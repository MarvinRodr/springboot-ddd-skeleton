name: SpringBoot DDD Skeleton - API | Github Workflows

on: [push]

jobs:
    build:
        runs-on: ubuntu-22.04

        steps:
            - name: ğŸ”€ Checkout ğŸ”€
              uses: actions/checkout@v3

            - name: Java 2ï¸âƒ£1ï¸âƒ£
              uses: actions/setup-java@v3
              with:
                  distribution: 'oracle'
                  java-version: 21

            - name: ğŸŒŠ Hello from SpringBoot DDD Skeleton Github Workflows! ğŸŒŠ
              run: echo "Hello from [${{ github.workflow }}]! triggered by the [${{ github.event_name }}] done by [${{ github.actor }}]"

            - name: ğŸ”§ Raise environment ğŸ”§
              run: |
                make package
                make docker-up-d

            - name: â³ Wait for the environment to be operational â³
              run: |
                  while ! make docker-ping-database &>/dev/null; do
                    echo "Waiting for database connection...ğŸ˜´"
                    sleep 2
                  done

            - name: ğŸ”¬ Run the tests ğŸ”¬
              run: make docker-test